#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Bloquear arquivos .env*
if git diff --cached --name-only | grep -E '\.env(\.local)?|\.env\..+'; then
  echo "❌ Commit bloqueado: não versione arquivos .env*"
  echo "   Use apenas .env.example com valores placeholder"
  exit 1
fi

# Bloquear possíveis segredos óbvios em staged files (exceto este próprio arquivo)
PATTERNS='(API_KEY|SECRET|TOKEN|PASSWORD|PRIVATE_KEY|SUPABASE_KEY|ZAPI_TOKEN|STRIPE_SECRET|JWT_|SENTRY_AUTH_TOKEN)'
if git diff --cached | grep -E "$PATTERNS" -n | grep -v ".husky/pre-commit"; then
  echo "❌ Commit suspeito: padrões de segredos detectados no diff staged"
  echo "   Verifique se não está commitando chaves reais"
  echo "   Use apenas valores placeholder como 'your_api_key_here'"
  exit 1
fi

echo "✅ Pre-commit check passed - no secrets detected"